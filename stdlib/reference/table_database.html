<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SecreC 2 language: Table database</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SecreC 2 language
   &#160;<span id="projectnumber">2.7.0 (2022.03)</span>
   </div>
   <div id="projectbrief">Language and standard library reference</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Table database </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Table databases in SecreC</p>
<h1><a class="anchor" id="table_database_section"></a>
Table database</h1>
<p>SecreC supports a basic file-based table database system intended for storing and organizing large amounts of data to be privately processed in SecreC.</p>
<p>Before creating a table a connection must be opened to the data source with the function <a class="el" href="group__tdb__open__connection.html#ga0bcfd77f0788fc899c71f1fa71cc5f9c">tdbOpenConnection</a>. The name of the data source is set in Sharemind's configuration. Before opening a new connection to a different data source make sure the old connection has been closed with <a class="el" href="group__tdb__close__connection.html#gac99927d4b604ef51d6b2fd56154d3bde">tdbCloseConnection</a>. A simple table with a uniform data type can be created with the function <a class="el" href="group__tdb__table__create.html#gad20935910e4c190fef3d0aabef570997">tdbTableCreate</a>.</p>
<p>Listing 1: Creating an empty table</p>
<div class="fragment"><div class="line"><span class="comment">//creating an empty table with 3 columns of type int32 and protection domain shared3p</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> shared3p;</div>
<div class="line"><span class="keyword">import</span> shared3p_table_database;</div>
<div class="line"><span class="keyword">import</span> stdlib;</div>
<div class="line"><span class="keyword">import</span> table_database;</div>
<div class="line"> </div>
<div class="line">domain pd_shared3p shared3p;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main () {</div>
<div class="line">        <span class="keywordtype">string</span> datasource = <span class="stringliteral">&quot;DS1&quot;</span>;</div>
<div class="line">        <span class="keywordtype">string</span> table_name = <span class="stringliteral">&quot;SimpleTable&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__tdb__open__connection.html#ga0bcfd77f0788fc899c71f1fa71cc5f9c">tdbOpenConnection</a> (datasource);</div>
<div class="line">        pd_shared3p int32 data_type;</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__shared3p__tdb__table__create.html#ga499f70a33808afcecc9175b0808d8762">tdbTableCreate</a> (datasource, table_name, data_type, (uint64) 3);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__shared3p__tdb__table__create_html_ga499f70a33808afcecc9175b0808d8762"><div class="ttname"><a href="group__shared3p__tdb__table__create.html#ga499f70a33808afcecc9175b0808d8762">tdbTableCreate</a></div><div class="ttdeci">void tdbTableCreate(string datasource, string table, D T[[N]] vtype, uint64 ncols)</div><div class="ttdef"><b>Definition:</b> shared3p_table_database.sc:263</div></div>
<div class="ttc" id="agroup__tdb__open__connection_html_ga0bcfd77f0788fc899c71f1fa71cc5f9c"><div class="ttname"><a href="group__tdb__open__connection.html#ga0bcfd77f0788fc899c71f1fa71cc5f9c">tdbOpenConnection</a></div><div class="ttdeci">void tdbOpenConnection(string datasource)</div><div class="ttdef"><b>Definition:</b> table_database.sc:251</div></div>
</div><!-- fragment --><p>Data is added to the table one row at a time with the function <a class="el" href="group__tdb__insert__row.html#ga195f0d0c7fdf623e899cd85d6f3daa3a">tdbInsertRow</a>. Each row is a vector with every element corresponding to a column in the table. Data is read from the table one column at a time with the function <a class="el" href="group__tdb__read__column__index__vec.html#ga6e9db85762b35a779e2839154e868b5a">tdbReadColumn</a>. The identifier of the column can be the column's index or the name of the column.</p>
<h2><a class="anchor" id="vmap"></a>
Vector Map</h2>
<p>A vector map (also referred to as a value map or a vmap) is a data structure for making more complicated tables with column identifiers and multiple data types. A vmap can contain four different types of information: types, strings, values and indexes. A vmap is similar to a Python dictionary as the vmap contains parameters and data associated to those parameters.</p>
<p>Values added to the vmap can be either fixed lenght or variable length. Variable length means that the size of values must not be uniform in one column e.g. strings or vectors with variable length. Values are stored in the vmap as batches. Each batch covers all columns but one row. Data can be added one entry at a time with<b> tdbVmapAdd{Type/String/Value/Index} </b>for fixed length data or with<b> tdbVmapAddVlen{Type/Value}</b> for variable length data.</p>
<h2><a class="anchor" id="vmap_table"></a>
Creating a table from a vector map</h2>
<p>When creating a table instead of specifing a data type and the number of columns a vmap can be used. The vmap must contain a type and string for every column with the parameters "types" and "names" respectively. Data can be inserted to the table with tdbInsertRow but instead of a vector a vmap can be used. The vmap must have values with the parameter "values" that are the same type as their respective column in the table. Every batch in the vmap corresponds to a single row in the table.</p>
<p>Listing 2: Creating a table with a vector map</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> shared3p;</div>
<div class="line"><span class="keyword">import</span> shared3p_table_database;</div>
<div class="line"><span class="keyword">import</span> stdlib;</div>
<div class="line"><span class="keyword">import</span> table_database;</div>
<div class="line"> </div>
<div class="line">domain pd_shared3p shared3p;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main() {</div>
<div class="line">        <span class="keywordtype">string</span> ds = <span class="stringliteral">&quot;DS1&quot;</span>; <span class="comment">// Data source name</span></div>
<div class="line">        <span class="keywordtype">string</span> tbl = <span class="stringliteral">&quot;table&quot;</span>; <span class="comment">// Table name</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Open database before running operations on it</span></div>
<div class="line">        <a class="code" href="group__tdb__open__connection.html#ga0bcfd77f0788fc899c71f1fa71cc5f9c">tdbOpenConnection</a>(ds);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if a table exists</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__tdb__table__exists.html#ga765a92d71229f262d7f466431eda9be7">tdbTableExists</a>(ds, tbl)) {</div>
<div class="line">                <span class="comment">// Delete existing table</span></div>
<div class="line">                <a class="code" href="group__tdb__table__delete.html#gabdafa3898e4f5cbaf27ac3958aedbca4">tdbTableDelete</a>(ds, tbl);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We want to create a simple table with three columns:</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//       -----------------------------------------------------------</span></div>
<div class="line">        <span class="comment">// Name: |       &quot;index&quot; |      &quot;measurement&quot; | &quot;have_measurement&quot; |</span></div>
<div class="line">        <span class="comment">// Type: | public uint64 | pd_shared3p uint64 |   pd_shared3p bool |</span></div>
<div class="line">        <span class="comment">//       -----------------------------------------------------------</span></div>
<div class="line">        <span class="comment">//       |             0 |                  0 |               true |</span></div>
<div class="line">        <span class="comment">//       |             1 |                 10 |               true |</span></div>
<div class="line">        <span class="comment">//       |             2 |                 20 |               true |</span></div>
<div class="line">        <span class="comment">//       |             3 |                 30 |               true |</span></div>
<div class="line">        <span class="comment">//       |             4 |                 40 |               true |</span></div>
<div class="line">        <span class="comment">//       -----------------------------------------------------------</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create a new &quot;vector map/value map&quot; for storing arguments to the table</span></div>
<div class="line">        <span class="comment">// creation call.</span></div>
<div class="line">        uint params = <a class="code" href="group__tdb__vmap__new.html#gabfaeca8b060d67cda1f4162e801945fa">tdbVmapNew</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Column 0, name &quot;index&quot;, type public uint64</span></div>
<div class="line">        {</div>
<div class="line">                uint64 vtype;</div>
<div class="line">                <a class="code" href="group__shared3p__tdb__vmap__add__type.html#ga3ee45ec6d05e6f3efc49a7b18f8065c0">tdbVmapAddType</a>(params, <span class="stringliteral">&quot;types&quot;</span>, vtype);</div>
<div class="line">                <a class="code" href="group__tdb__vmap__add__string.html#ga12ececcbf78da8ceca2f08b7cd8af00d">tdbVmapAddString</a>(params, <span class="stringliteral">&quot;names&quot;</span>, <span class="stringliteral">&quot;index&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Column 1, name &quot;measurement&quot;, type pd_shared3p uint64</span></div>
<div class="line">        {</div>
<div class="line">                pd_shared3p uint64 vtype;</div>
<div class="line">                <a class="code" href="group__shared3p__tdb__vmap__add__type.html#ga3ee45ec6d05e6f3efc49a7b18f8065c0">tdbVmapAddType</a>(params, <span class="stringliteral">&quot;types&quot;</span>, vtype);</div>
<div class="line">                <a class="code" href="group__tdb__vmap__add__string.html#ga12ececcbf78da8ceca2f08b7cd8af00d">tdbVmapAddString</a>(params, <span class="stringliteral">&quot;names&quot;</span>, <span class="stringliteral">&quot;measurement&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Column 2, name &quot;have_measurement&quot;, type pd_shared3p bool</span></div>
<div class="line">        {</div>
<div class="line">                pd_shared3p <span class="keywordtype">bool</span> vtype;</div>
<div class="line">                <a class="code" href="group__shared3p__tdb__vmap__add__type.html#ga3ee45ec6d05e6f3efc49a7b18f8065c0">tdbVmapAddType</a>(params, <span class="stringliteral">&quot;types&quot;</span>, vtype);</div>
<div class="line">                <a class="code" href="group__tdb__vmap__add__string.html#ga12ececcbf78da8ceca2f08b7cd8af00d">tdbVmapAddString</a>(params, <span class="stringliteral">&quot;names&quot;</span>, <span class="stringliteral">&quot;have_measurement&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create the table</span></div>
<div class="line">        <a class="code" href="group__shared3p__tdb__table__create.html#ga499f70a33808afcecc9175b0808d8762">tdbTableCreate</a>(ds, tbl, params);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Free the parameter map</span></div>
<div class="line">        <a class="code" href="group__tdb__vmap__delete.html#ga6b598a47b9dcb86616196be22285ec80">tdbVmapDelete</a>(params);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Insert some data</span></div>
<div class="line">        uint nrows = 5;</div>
<div class="line">        params = <a class="code" href="group__tdb__vmap__new.html#gabfaeca8b060d67cda1f4162e801945fa">tdbVmapNew</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (uint i = 0; i &lt; nrows; ++i) {</div>
<div class="line">                uint64 index = i;</div>
<div class="line">                pd_shared3p uint64 measurement = i * 10;</div>
<div class="line">                pd_shared3p <span class="keywordtype">bool</span> have_measurement = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (i != 0) {</div>
<div class="line">                        <span class="comment">// This has to be called in-between rows</span></div>
<div class="line">                        <a class="code" href="group__tdb__vmap__add__batch.html#gace4b1d8120abf594f2992fa1e76991b3">tdbVmapAddBatch</a>(params);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <a class="code" href="group__shared3p__tdb__vmap__add__value__scalar.html#ga1437f0db9bb11c02ae10e5c4452a083c">tdbVmapAddValue</a>(params, <span class="stringliteral">&quot;values&quot;</span>, index);</div>
<div class="line">                <a class="code" href="group__shared3p__tdb__vmap__add__value__scalar.html#ga1437f0db9bb11c02ae10e5c4452a083c">tdbVmapAddValue</a>(params, <span class="stringliteral">&quot;values&quot;</span>, measurement);</div>
<div class="line">                <a class="code" href="group__shared3p__tdb__vmap__add__value__scalar.html#ga1437f0db9bb11c02ae10e5c4452a083c">tdbVmapAddValue</a>(params, <span class="stringliteral">&quot;values&quot;</span>, have_measurement);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__shared3p__tdb__insert__row.html#ga0fb8a17d919f576b83a8a327ab88cc2e">tdbInsertRow</a>(ds, tbl, params);</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="agroup__shared3p__tdb__insert__row_html_ga0fb8a17d919f576b83a8a327ab88cc2e"><div class="ttname"><a href="group__shared3p__tdb__insert__row.html#ga0fb8a17d919f576b83a8a327ab88cc2e">tdbInsertRow</a></div><div class="ttdeci">void tdbInsertRow(string datasource, string table, D T[[1]] values)</div><div class="ttdef"><b>Definition:</b> shared3p_table_database.sc:281</div></div>
<div class="ttc" id="agroup__shared3p__tdb__vmap__add__type_html_ga3ee45ec6d05e6f3efc49a7b18f8065c0"><div class="ttname"><a href="group__shared3p__tdb__vmap__add__type.html#ga3ee45ec6d05e6f3efc49a7b18f8065c0">tdbVmapAddType</a></div><div class="ttdeci">void tdbVmapAddType(uint64 id, string paramname, D T t)</div><div class="ttdef"><b>Definition:</b> shared3p_table_database.sc:58</div></div>
<div class="ttc" id="agroup__shared3p__tdb__vmap__add__value__scalar_html_ga1437f0db9bb11c02ae10e5c4452a083c"><div class="ttname"><a href="group__shared3p__tdb__vmap__add__value__scalar.html#ga1437f0db9bb11c02ae10e5c4452a083c">tdbVmapAddValue</a></div><div class="ttdeci">void tdbVmapAddValue(uint64 id, string paramname, D T value)</div><div class="ttdef"><b>Definition:</b> shared3p_table_database.sc:92</div></div>
<div class="ttc" id="agroup__tdb__table__delete_html_gabdafa3898e4f5cbaf27ac3958aedbca4"><div class="ttname"><a href="group__tdb__table__delete.html#gabdafa3898e4f5cbaf27ac3958aedbca4">tdbTableDelete</a></div><div class="ttdeci">void tdbTableDelete(string datasource, string table)</div><div class="ttdef"><b>Definition:</b> table_database.sc:317</div></div>
<div class="ttc" id="agroup__tdb__table__exists_html_ga765a92d71229f262d7f466431eda9be7"><div class="ttname"><a href="group__tdb__table__exists.html#ga765a92d71229f262d7f466431eda9be7">tdbTableExists</a></div><div class="ttdeci">bool tdbTableExists(string datasource, string table)</div><div class="ttdef"><b>Definition:</b> table_database.sc:329</div></div>
<div class="ttc" id="agroup__tdb__vmap__add__batch_html_gace4b1d8120abf594f2992fa1e76991b3"><div class="ttname"><a href="group__tdb__vmap__add__batch.html#gace4b1d8120abf594f2992fa1e76991b3">tdbVmapAddBatch</a></div><div class="ttdeci">void tdbVmapAddBatch(uint64 id)</div><div class="ttdef"><b>Definition:</b> table_database.sc:215</div></div>
<div class="ttc" id="agroup__tdb__vmap__add__string_html_ga12ececcbf78da8ceca2f08b7cd8af00d"><div class="ttname"><a href="group__tdb__vmap__add__string.html#ga12ececcbf78da8ceca2f08b7cd8af00d">tdbVmapAddString</a></div><div class="ttdeci">void tdbVmapAddString(uint64 id, string paramname, string str)</div><div class="ttdef"><b>Definition:</b> table_database.sc:180</div></div>
<div class="ttc" id="agroup__tdb__vmap__delete_html_ga6b598a47b9dcb86616196be22285ec80"><div class="ttname"><a href="group__tdb__vmap__delete.html#ga6b598a47b9dcb86616196be22285ec80">tdbVmapDelete</a></div><div class="ttdeci">void tdbVmapDelete(uint64 id)</div><div class="ttdef"><b>Definition:</b> table_database.sc:112</div></div>
<div class="ttc" id="agroup__tdb__vmap__new_html_gabfaeca8b060d67cda1f4162e801945fa"><div class="ttname"><a href="group__tdb__vmap__new.html#gabfaeca8b060d67cda1f4162e801945fa">tdbVmapNew</a></div><div class="ttdeci">uint64 tdbVmapNew()</div><div class="ttdef"><b>Definition:</b> table_database.sc:100</div></div>
</div><!-- fragment --><h2><a class="anchor" id="clean_up"></a>
Erasing tables</h2>
<p>Before creating a new table it is recommended to check if a table with the same name already exists and delete it if it does. A table can be deleted with <a class="el" href="group__tdb__table__delete.html#gabdafa3898e4f5cbaf27ac3958aedbca4">tdbTableDelete</a>. After the program finishes SecreC automatically deletes all existing vector maps but for safety concerns it is advised to do this manually. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 25 2022 15:53:56 for SecreC 2 language by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
